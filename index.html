<!DOCTYPE html>
<html>
<head>
  <meta charset = "utf-8">
    <style>
      #fs {
        display: flex;
        justify-content: center;
        margin: 0 auto;
        width: 100%;
      }
      .buttonrow1 {
        display: flex;
        flex-grow: 1;
        height: 100px;
        justify-content: center;
      }
    </style>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    #container {
      max-width: 800px; /* optional, for nicer width */
      margin: 0 auto;
    }
    #fs {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      gap: 10px;
    }
    #fs button {
      flex: 1; /* buttons share width equally */
      height: 50px;
    }
    textarea {
      width: 100%;
      height: 400px;
      font-size: 16px;
      padding: 10px;
    }
    #editor {
      font-size: 11px;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="fs">
      <button id="fsbtn">Enter Fullscreen</button>
      <button onclick="document.exitFullscreen()">Exit Fullscreen</button>
    </div>
    <textarea id="editor" placeholder="Type Here..." style="font-family: Comic Sans MS"></textarea>
  </div>
    <script>
let fsBtn = document.getElementById("fsbtn");
fsBtn.addEventListener("click", () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch((err) => {
            window.open("", "_blank");
            window.close();
        });
    }
});
    </script>

  <script>
    // Fullscreen logic (unchanged)
    let fsBtn = document.getElementById("fsbtn");
    fsBtn.addEventListener("click", () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch((err) => {
          window.open("", "_blank");
          window.close();
        });
      }
    });
  </script>

  <script type="module">
    import * as Y from 'https://cdn.jsdelivr.net/npm/yjs@13.8.13/dist/yjs.mjs';
    import { WebrtcProvider } from 'https://cdn.jsdelivr.net/npm/y-webrtc@10.0.7/dist/y-webrtc.mjs';
    import { IndexeddbPersistence } from 'https://cdn.jsdelivr.net/npm/y-indexeddb@1.2.4/dist/y-indexeddb.mjs';

    let docId = location.hash.slice(1);
    if (!docId) {
      docId = Math.random().toString(36).slice(2, 10);
      location.hash = docId;
    }

    const doc = new Y.Doc();
    const persistence = new IndexeddbPersistence(docId, doc);

    const textarea = document.getElementById('editor');
    const fontel = document.getElementById('fonts');

    persistence.whenSynced.then(() => {
      console.log('Document loaded from IndexedDB!');
      textarea.value = ytext.toString();
    });

    const provider = new WebrtcProvider(docId, doc);
    const ytext = doc.getText('shared-text');

    // Update Yjs document as user types
    textarea.addEventListener('input', () => {
      ytext.doc.transact(() => {
        ytext.delete(0, ytext.length);
        ytext.insert(0, textarea.value);
      });
    });

    // Reflect Yjs changes in textarea
    ytext.observe(() => {
      const current = textarea.value;
      const newText = ytext.toString();
      if (current !== newText) {
        textarea.value = newText;
      }
    });

    // Shared map for styles
    const ystyle = doc.getMap("style");

    // Apply current shared font when joining
    const currentFont = ystyle.get("fontFamily") || fontel.value;
    textarea.style.fontFamily = currentFont;
    fontel.value = currentFont;

    // Listen for changes from peers
    ystyle.observe(() => {
      const font = ystyle.get("fontFamily");
      if (font) {
        textarea.style.fontFamily = font;
        fontel.value = font;
      }
    });

    // Update shared font when user selects a new font
    fontel.addEventListener("change", () => {
      const font = fontel.value;
      textarea.style.fontFamily = font;
      ystyle.set("fontFamily", font);
    });
  </script>
</body>
</html>
